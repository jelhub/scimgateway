// ================================================================
// File:    scim-stream.js
//
// Author:  Jarle Elshaug
//
// Purpose: SCIM Stream message subscription and automated provisioning
//          Gateway publishing to SCIM Stream having other gateways as subscribers handling requests
//          getApproles() for exporting all groups into Entra ID AppRole manifest-format
//
// Note: scim-stream.js is part of the licensed SCIM Stream which is a prerequisite for message Pub/Sub
//       for details see: https://elshaug.xyz/docs/scim-stream
//
// ================================================================
'use strict';(function(_0x5e928b,_0x2c2644){const _0x5d455c=a0_0x34d9,_0x56ee6c=_0x5e928b();while(!![]){try{const _0xa586ba=-parseInt(_0x5d455c(0x2e4))/0x1*(parseInt(_0x5d455c(0x283))/0x2)+-parseInt(_0x5d455c(0x28f))/0x3+parseInt(_0x5d455c(0x203))/0x4*(-parseInt(_0x5d455c(0x25f))/0x5)+-parseInt(_0x5d455c(0x287))/0x6+parseInt(_0x5d455c(0x2d2))/0x7+parseInt(_0x5d455c(0x28c))/0x8*(parseInt(_0x5d455c(0x1ec))/0x9)+parseInt(_0x5d455c(0x1fa))/0xa;if(_0xa586ba===_0x2c2644)break;else _0x56ee6c['push'](_0x56ee6c['shift']());}catch(_0x405f35){_0x56ee6c['push'](_0x56ee6c['shift']());}}}(a0_0x24b0,0x2e6ab));import{jwtAuthenticator,headers}from'@nats-io/nats-core';import{jetstream,jetstreamManager,DeliverPolicy,AckPolicy}from'@nats-io/jetstream';import{connect as a0_0x2986f3}from'@nats-io/transport-node';function a0_0x34d9(_0x494f7f,_0x25b0d1){const _0x24b016=a0_0x24b0();return a0_0x34d9=function(_0x34d951,_0x372623){_0x34d951=_0x34d951-0x1e7;let _0x1bd830=_0x24b016[_0x34d951];return _0x1bd830;},a0_0x34d9(_0x494f7f,_0x25b0d1);}import a0_0x2bce72 from'fold-to-ascii';function a0_0x24b0(){const _0x4f4713=['\x20convertedScim20\x20error:\x20','isArray','6KbmDSX','approles_','startsWith','from','Operations',']\x20error:\x20client\x20have\x20not\x20been\x20initialized','passThrough','uppercase','getAppRoles','UnableConnectingHost','\x20handling\x20message:\x20','response','type','\x20error:\x20','tls','logger','\x20getUserId()\x20error:\x20','ctx',']\x20connected\x20','info','normalize','\x20message:\x20user\x20not\x20created\x20because\x20of\x20active=false','GET\x20serviceplans',']\x20initialization\x20error:\x20missing\x20configuration\x20nats.subject','true','\x20error:\x20more\x20than\x20one\x20user\x20were\x20found}','publisher\x20error:\x20none\x20JSON\x20formatted\x20response:\x20','content-type','lowercase','errName','SCIM-Stream','\x20error:\x20missing\x20id}','add','ENOTFOUND','reconnecting','method','\x20role\x20removal\x20error:\x20',']\x20error:\x20missing\x20entity\x20configuration\x20for\x20baseEntity=','PUT\x20users','DELETE','nats','jwt','\x20(count=','url','35514kUTtJF','?filter=userName\x20eq\x20\x22','file-not-configured','convertedScim20','waitOnFirstConnect','timeout','schemas','getEncrypted','/Users/','parse','subscriber\x20message\x20error:\x20message\x20not\x20JSON\x20formatted','newHelperRest','Users',']\x20subscriber[','3818720xDACLm','createRandomPassword','operation','prototype','patchApiHandler','readFileSync',']\x20client\x20is\x20attempting\x20to\x20reconnect\x20','maxPingOut','path','4ZKpULv','reconnect','includes','bearerToken','maxReconnectAttempts','\x20Create\x20userName=',']\x20onChainingHandler\x20error:\x20configuration\x20scimgateway.chainingBaseUrl\x20missing','Bearer\x20','{\x22error\x22:\x22','tenant','statusCode','respond','rejectUnauthorized','mkdirSync','usePutSoftSync','postHandler','publish','encode',']\x20client\x20reconnected\x20','\x20Delete\x20User\x20userName=','secret',',\x20id=','replaceUsrGrp()\x20error:\x20stream\x20replaceUsrGrp\x20must\x20be\x20type\x20\x22Users\x22','baseUrls','onCreate','NOT_FOUND','getServer','replaceDomains','base64','toLowerCase','getUsers()\x20getObj=',']\x20onChainingHandler\x20error:\x20configuration\x20scimgateway.chainingBaseUrl\x20must\x20use\x20correct\x20syntax\x20\x27http(s)://host:port\x27\x20error:\x20','operator',',false','username','drain','utf-8','handle','POST\x20users','POST\x20api','/Users','publisher[',']\x20initialization\x20error:\x20missing\x20configuration\x20nats.tenant','Explicit',']\x20error:\x20message\x20must\x20be\x20JSON\x20formatted','\x20done','string','password','activityOperation','sub','stringify','/approles','headers','auth','/certs/',']\x20initialization\x20certificate\x20error:\x20','certificate','DELETE\x20users','length','SIGTERM','trim','503','PATCH\x20groups','message','debug','replaceAll','\x20message:\x20user\x20not\x20deleted\x20because\x20of\x20configuration\x20modifyOnly=true','ack','basic','postApiHandler','\x20Delete\x20User\x20id=','patchHandler','split','get','gwName','push',']\x20closed\x20with\x20error:\x20','externalId','replaceUsrGrp','false','Resources','fsExistsSync',']\x20error:\x20','helperRest','GET','generateUserPassword','call','baseEntity','?filter=externalId\x20eq\x20\x22','}\x20message\x20error\x20response:\x20',']\x20subscriber\x20stopped\x20error:\x20','##doIncrement','68135FHfBhs','consumer_not_found','set','status','POST\x20groups','user',']\x20client\x20error\x20','\x20Create\x20User\x20userName=','groups',']\x20publisher[','putApiHandler','putHandler',']\x20connect\x20error:\x20','consumers','getHandlerServiceProviderConfig','foldReplacing','indexOf','copyObj','pluginName',',true','User','getHandlerId','\x20missing\x20user\x20object\x20in\x20message:\x20','then','GET\x20api','\x20=>\x20subscriber\x20not\x20activated','getUsers','subject','GET\x20schemas','routeObj','deleteUser','request',']\x20client\x20has\x20a\x20stale\x20connection\x20','\x20result=','\x20error:\x20missing\x20result','getHandlerSchemas','25394CihkQI','DELETE\x20groups','toUpperCase','\x20-\x20will\x20do\x20auto\x20connect\x20when\x20available\x20-\x20however,\x20please\x20verify\x20stream\x20configuration','1920546lsVZHr','replace','elementnumber','scimgateway','_autogenerated.cfg','392eILPUc','GET\x20serviceproviderconfig','existsSync','483852BAoeQh','Application','getuniquevalue','all','chainingBaseUrl','DELETE\x20api','undefined','modifyOnly','authorization','UnableConnectingService','ETIMEDOUT','body','\x20Replace\x20User\x20id=','value','attribute','delete','roles','GET\x20groups','ECONNREFUSED','doIncrement','\x20message\x20handled:\x20',']\x20initialization\x20error:\x20nats.subject\x20root\x20topic\x20must\x20be\x20\x27GW\x27,\x20nats.subject\x20example:\x20GW.APP1','close','obj','join','&attributes=','authenticator','func','GW.','PATCH\x20api','data','name','display','skipConvertRolesToGroups','PUT\x20groups','increment','active','reconnectTimeWait','userName','constructor','application/scim+json;\x20charset=utf-8',']\x20initialization\x20error:\x20missing\x20configuration\x20nats','isClosed','disconnect','server_name','append',',\x20obj=',']\x20client\x20disconnected\x20',']\x20client\x20consumer\x20reinitiated\x20because\x20of\x20','charAt','\x20processing\x20incoming\x20message','publisher\x20not\x20initialized/connected','POST','\x20-\x20','internal\x20stream\x20policy\x20have\x20been\x20changed\x20-\x20central\x20SCIM\x20Stream\x20must\x20be\x20stopped\x20and\x20corresponding\x20./jetstream\x20folder\x20deleted\x20before\x20startup\x20allowing\x20new\x20policy','_info','config','doRequest','toString','error','SIGINT','write',']\x20initialization\x20error:\x20missing\x20certificate\x20configuration','modifyUser','hasOwnProperty','getGroups','configDir','1302567IRyffM','\x20createUser()\x20obj=','pingInterval','forEach','utf8','createWriteStream','streamChaining\x20error:\x20','substring','randomUUID',']\x20handling\x20\x22','modifyGroup','HR.','publisher\x20response\x20error:\x20','subscribe','servers','deliver_policy'];a0_0x24b0=function(){return _0x4f4713;};return a0_0x24b0();}import a0_0x3f708b from'node:fs';import a0_0x3bb54d from'node:path';import a0_0x15e0d8 from'node:crypto';import*as a0_0x35610e from'./utils.ts';import*as a0_0x3a7846 from'./utils-scim.ts';export class Subscriber{constructor(_0x158326,_0x8631){const _0xbd1d74=a0_0x34d9,_0x4806c9=_0x158326,_0x15dd9a={},_0x76894b=_0x4806c9[_0xbd1d74(0x2c7)]['scimgateway']['chainingBaseUrl'];let _0x12a8e9='';if(_0x76894b){if(_0x4806c9[_0xbd1d74(0x2c7)]['scimgateway']?.[_0xbd1d74(0x238)]?.[_0xbd1d74(0x206)]&&Array[_0xbd1d74(0x2e3)](_0x4806c9[_0xbd1d74(0x2c7)][_0xbd1d74(0x28a)][_0xbd1d74(0x238)][_0xbd1d74(0x206)])&&_0x4806c9[_0xbd1d74(0x2c7)][_0xbd1d74(0x28a)][_0xbd1d74(0x238)]['bearerToken'][_0xbd1d74(0x23d)]>0x0){const _0x5642cf=_0x4806c9[_0xbd1d74(0x2c7)][_0xbd1d74(0x28a)]['auth'][_0xbd1d74(0x206)];if(_0x5642cf[0x0]['token']){const _0x1f1e50=Buffer['from'](_0x5642cf[0x0]['token'])[_0xbd1d74(0x2c9)](_0xbd1d74(0x21f));_0x12a8e9=_0xbd1d74(0x20a)+_0x1f1e50;}}if(!_0x12a8e9&&_0x4806c9[_0xbd1d74(0x2c7)]['scimgateway']?.[_0xbd1d74(0x238)]?.[_0xbd1d74(0x247)]&&Array[_0xbd1d74(0x2e3)](_0x4806c9[_0xbd1d74(0x2c7)][_0xbd1d74(0x28a)][_0xbd1d74(0x238)][_0xbd1d74(0x247)])&&_0x4806c9[_0xbd1d74(0x2c7)][_0xbd1d74(0x28a)][_0xbd1d74(0x238)][_0xbd1d74(0x247)][_0xbd1d74(0x23d)]>0x0){const _0x3ea21d=_0x4806c9[_0xbd1d74(0x2c7)][_0xbd1d74(0x28a)][_0xbd1d74(0x238)][_0xbd1d74(0x247)];if(_0x3ea21d[0x0][_0xbd1d74(0x225)]&&_0x3ea21d[0x0][_0xbd1d74(0x232)]){const _0xf1e666=Buffer[_0xbd1d74(0x2e7)](_0x3ea21d[0x0][_0xbd1d74(0x225)]+':'+_0x3ea21d[0x0]['password'])[_0xbd1d74(0x2c9)]('base64');_0x12a8e9='Basic\x20'+_0xf1e666;}}}const _0x593924=async(_0x51ba1b,_0x532a34)=>{const _0x33d5be=_0xbd1d74,_0x41d7f6=_0x15dd9a[_0x51ba1b][_0x33d5be(0x2c7)]?.['nats']?.[_0x33d5be(0x27a)];let _0x9a32f8;try{_0x9a32f8=await a0_0x2986f3(_0x532a34);if(_0x9a32f8[_0x33d5be(0x2f7)]['server_name']!==_0x33d5be(0x302)){_0x9a32f8[_0x33d5be(0x2a5)]();return;}_0x15dd9a[_0x51ba1b]['nc']=_0x9a32f8,_0x1e2800(_0x51ba1b,_0x9a32f8),_0x3039e8(_0x51ba1b,_0x9a32f8);}catch(_0x3cb372){_0x4806c9['logger'][_0x33d5be(0x2ca)](_0x4806c9['gwName']+'['+_0x4806c9[_0x33d5be(0x271)]+_0x33d5be(0x1f9)+_0x51ba1b+']['+_0x41d7f6+']\x20connect\x20error:\x20'+_0x3cb372[_0x33d5be(0x242)]+_0x33d5be(0x286)),_0x532a34[_0x33d5be(0x1f0)]=!![];try{_0x9a32f8=await a0_0x2986f3(_0x532a34);if(_0x9a32f8[_0x33d5be(0x2f7)][_0x33d5be(0x2bb)]!==_0x33d5be(0x302)){_0x9a32f8[_0x33d5be(0x2a5)]();return;}_0x15dd9a[_0x51ba1b]['nc']=_0x9a32f8,_0x1e2800(_0x51ba1b,_0x9a32f8),_0x3039e8(_0x51ba1b,_0x9a32f8);}catch(_0x161b2c){_0x4806c9[_0x33d5be(0x2f3)][_0x33d5be(0x2ca)](_0x4806c9['gwName']+'['+_0x4806c9[_0x33d5be(0x271)]+']\x20subscriber['+_0x51ba1b+']['+_0x41d7f6+_0x33d5be(0x26b)+_0x161b2c[_0x33d5be(0x242)]);return;}}_0x4806c9[_0x33d5be(0x2f3)]['debug'](_0x4806c9[_0x33d5be(0x24d)]+'['+_0x4806c9[_0x33d5be(0x271)]+_0x33d5be(0x1f9)+_0x51ba1b+']['+_0x41d7f6+_0x33d5be(0x2f6)+(_0x532a34[_0x33d5be(0x2f2)]['ca']?'tls':'')+'\x20'+_0x9a32f8[_0x33d5be(0x21d)]()),_0x9a32f8['closed']()['then'](_0x3845fb=>{const _0x15b5dc=_0x33d5be;_0x3845fb&&_0x4806c9['logger']['error'](_0x4806c9[_0x15b5dc(0x24d)]+'['+_0x4806c9['pluginName']+_0x15b5dc(0x1f9)+_0x51ba1b+']['+_0x41d7f6+_0x15b5dc(0x24f)+_0x3845fb['message']);});};this[_0xbd1d74(0x304)]=async(_0x3c28aa,_0x5ee405)=>{const _0x21e76b=_0xbd1d74;if(!_0x5ee405?.['nats']){_0x4806c9[_0x21e76b(0x2f3)][_0x21e76b(0x2ca)](_0x4806c9[_0x21e76b(0x24d)]+'['+_0x4806c9[_0x21e76b(0x271)]+_0x21e76b(0x1f9)+_0x3c28aa+']\x20initialization\x20error:\x20missing\x20configuration\x20nats');return;}if(!_0x5ee405?.[_0x21e76b(0x1e8)]?.[_0x21e76b(0x20c)]){_0x4806c9[_0x21e76b(0x2f3)][_0x21e76b(0x2ca)](_0x4806c9[_0x21e76b(0x24d)]+'['+_0x4806c9['pluginName']+_0x21e76b(0x1f9)+_0x3c28aa+_0x21e76b(0x22d));return;}if(!_0x5ee405?.['nats']?.[_0x21e76b(0x27a)]){_0x4806c9[_0x21e76b(0x2f3)][_0x21e76b(0x2ca)](_0x4806c9['gwName']+'['+_0x4806c9[_0x21e76b(0x271)]+_0x21e76b(0x1f9)+_0x3c28aa+']\x20initialization\x20error:\x20missing\x20configuration\x20nats.subject');return;}if(!_0x5ee405?.[_0x21e76b(0x23b)]?.['ca']){_0x4806c9[_0x21e76b(0x2f3)][_0x21e76b(0x2ca)](_0x4806c9[_0x21e76b(0x24d)]+'['+_0x4806c9['pluginName']+']\x20subscriber['+_0x3c28aa+']\x20initialization\x20error:\x20missing\x20certificate\x20configuration');return;}if(!_0x5ee405[_0x21e76b(0x21a)]||!Array[_0x21e76b(0x2e3)](_0x5ee405[_0x21e76b(0x21a)])||_0x5ee405['baseUrls'][_0x21e76b(0x23d)]<0x1){_0x4806c9['logger'][_0x21e76b(0x2ca)](_0x4806c9[_0x21e76b(0x24d)]+'['+_0x4806c9[_0x21e76b(0x271)]+_0x21e76b(0x1f9)+_0x3c28aa+']\x20initialization\x20error:\x20missing\x20configuration\x20stream.baseUrls');return;}if(!_0x5ee405[_0x21e76b(0x211)]){const _0x410c85=_0x5ee405?.[_0x21e76b(0x1e8)]?.[_0x21e76b(0x27a)][_0x21e76b(0x285)]();if(_0x410c85['startsWith'](_0x21e76b(0x2dd)))_0x5ee405[_0x21e76b(0x211)]=!![];}const _0x17f691={};try{let _0x34ef4f=a0_0x3bb54d['join'](_0x4806c9[_0x21e76b(0x2d1)],_0x21e76b(0x239),_0x5ee405?.[_0x21e76b(0x23b)]?.['ca']||_0x21e76b(0x1ee));(_0x5ee405?.['certificate']?.['ca']?.[_0x21e76b(0x2e6)]('/')||_0x5ee405?.[_0x21e76b(0x23b)]?.['ca']?.[_0x21e76b(0x205)]('\x5c'))&&(_0x34ef4f=_0x5ee405[_0x21e76b(0x23b)]['ca']),_0x17f691['ca']=[a0_0x3f708b[_0x21e76b(0x1ff)](_0x34ef4f)],_0x17f691[_0x21e76b(0x20f)]=!![];}catch(_0x5a3755){_0x4806c9[_0x21e76b(0x2f3)][_0x21e76b(0x2ca)](_0x4806c9[_0x21e76b(0x24d)]+'['+_0x4806c9[_0x21e76b(0x271)]+']\x20subscriber['+_0x3c28aa+_0x21e76b(0x23a)+_0x5a3755['message']);return;}const _0x45df28={},_0x860e18=new TextEncoder()[_0x21e76b(0x214)](_0x5ee405?.[_0x21e76b(0x1e8)]?.[_0x21e76b(0x217)]),_0x26bb06=_0x5ee405?.['nats']?.['jwt'];_0x45df28['authenticator']=jwtAuthenticator(_0x26bb06,_0x860e18),_0x45df28[_0x21e76b(0x2e0)]=_0x5ee405['baseUrls'],_0x45df28[_0x21e76b(0x2f2)]=_0x17f691,_0x45df28['waitOnFirstConnect']=![],_0x45df28[_0x21e76b(0x204)]=!![],_0x45df28[_0x21e76b(0x2b4)]=0x3e8*0xa,_0x45df28[_0x21e76b(0x207)]=-0x1,_0x45df28[_0x21e76b(0x2d4)]=0x2*0x3c*0x3e8,_0x45df28[_0x21e76b(0x201)]=0x5,_0x45df28[_0x21e76b(0x243)]=![],_0x15dd9a[_0x3c28aa]={},_0x15dd9a[_0x3c28aa][_0x21e76b(0x2c7)]=_0x5ee405,_0x15dd9a[_0x3c28aa]['nc']=undefined,_0x15dd9a[_0x3c28aa][_0x21e76b(0x234)]=undefined,_0x593924(_0x3c28aa,_0x45df28);};const _0x3039e8=async(_0x1f1ff9,_0x57e74a)=>{const _0x32ab6c=_0xbd1d74,_0x379a2b=_0x15dd9a[_0x1f1ff9]['config'],_0x243918=_0x379a2b?.[_0x32ab6c(0x1e8)]?.[_0x32ab6c(0x27a)];if(!_0x57e74a){_0x4806c9[_0x32ab6c(0x2f3)][_0x32ab6c(0x2ca)](_0x4806c9[_0x32ab6c(0x24d)]+'['+_0x4806c9[_0x32ab6c(0x271)]+_0x32ab6c(0x1f9)+_0x1f1ff9+']['+_0x243918+_0x32ab6c(0x2e9));return;}const _0x5b325e=async(_0x3097c2,_0x5977a6)=>{const _0x329525=_0x32ab6c;try{_0x4806c9[_0x329525(0x2f3)][_0x329525(0x2f7)](_0x3097c2+_0x329525(0x2ee)+_0x5977a6);let _0xf4a638;try{if(_0x379a2b[_0x329525(0x21e)]&&Array[_0x329525(0x2e3)](_0x379a2b[_0x329525(0x21e)]))for(let _0x390813=0x0;_0x390813<_0x379a2b['replaceDomains']['length'];_0x390813++){const _0x449379=_0x379a2b[_0x329525(0x21e)][_0x390813];if(!_0x449379[_0x329525(0x2e7)]||!_0x449379['from'][_0x329525(0x205)]('.')||!_0x449379['to']||!_0x449379['to'][_0x329525(0x205)]('.'))continue;const _0x5a0ff5=new RegExp('@'+_0x449379['from']+'\x22','gi');_0x5977a6=_0x5977a6['replace'](_0x5a0ff5,'@'+_0x449379['to']+'\x22');}_0xf4a638=JSON[_0x329525(0x1f5)](_0x5977a6);}catch(_0x491fba){_0x4806c9[_0x329525(0x2f3)][_0x329525(0x2ca)](_0x3097c2+'\x20message\x20json\x20parsing\x20error:\x20'+_0x491fba[_0x329525(0x242)]+'\x20message:\x20'+_0x5977a6),_0x4806c9['logger'][_0x329525(0x243)](_0x3097c2+_0x329525(0x230));return;}const _0x3bcdd3=_0xf4a638[_0x329525(0x264)];if(!_0x3bcdd3){_0x4806c9[_0x329525(0x2f3)]['error'](_0x3097c2+_0x329525(0x275)+JSON[_0x329525(0x235)](_0xf4a638)),_0x4806c9['logger']['debug'](_0x3097c2+_0x329525(0x230));return;}if(!_0x3bcdd3[_0x329525(0x2b5)]){_0x4806c9['logger'][_0x329525(0x2ca)](_0x3097c2+'\x20missing\x20mandatory\x20user.userName\x20in\x20message:\x20'+JSON['stringify'](_0xf4a638)),_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+_0x329525(0x230));return;}delete _0x3bcdd3[_0x329525(0x1f2)];let _0x2ea299;_0x3bcdd3['id']&&(_0x2ea299=_0x3bcdd3['id'],delete _0x3bcdd3['id']);let _0x5e2d31;_0x3bcdd3['onCreate']&&(_0x5e2d31=a0_0x35610e[_0x329525(0x270)](_0x3bcdd3[_0x329525(0x21b)]),delete _0x3bcdd3[_0x329525(0x21b)]);await _0x22e4d6(_0x1f1ff9,_0x3bcdd3);const _0x391325=_0x3bcdd3[_0x329525(0x2b5)];let _0x702b48,_0x29f828;try{_0x702b48=await _0x284394(_0x1f1ff9,_0x329525(0x2b5),_0x391325);}catch(_0x57fc48){_0x4806c9['logger'][_0x329525(0x2ca)](_0x3097c2+_0x329525(0x2f4)+_0x57fc48[_0x329525(0x242)]),_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+'\x20done');const _0x3f6be0=[_0x329525(0x2ed),_0x329525(0x298),_0x329525(0x2a1),_0x329525(0x305),_0x329525(0x299),_0x329525(0x1f1)];for(const _0x2636cc in _0x3f6be0){if(_0x57fc48['message'][_0x329525(0x205)](_0x2636cc))return!![];}return;}if(!_0x379a2b[_0x329525(0x2b0)]){let _0x521ae9=![];if(_0xf4a638[_0x329525(0x2e8)]&&Array['isArray'](_0xf4a638[_0x329525(0x2e8)]))for(let _0x48ee79=0x0;_0x48ee79<_0xf4a638[_0x329525(0x2e8)][_0x329525(0x23d)];_0x48ee79++){const _0x55ce89=_0xf4a638[_0x329525(0x2e8)][_0x48ee79];_0x55ce89[_0x329525(0x202)][_0x329525(0x2e6)](_0x329525(0x29f))&&(_0x55ce89[_0x329525(0x202)]=_0x329525(0x267),Array[_0x329525(0x2e3)](_0x55ce89[_0x329525(0x29c)])?(_0x55ce89[_0x329525(0x29c)][0x0]['id']=_0x55ce89[_0x329525(0x29c)][0x0][_0x329525(0x29c)],_0x55ce89[_0x329525(0x29c)][0x0]['display']=_0x55ce89[_0x329525(0x29c)][0x0][_0x329525(0x2f0)]+_0x329525(0x2c4)+_0x55ce89[_0x329525(0x29c)][0x0][_0x329525(0x29c)],delete _0x55ce89['value'][0x0][_0x329525(0x29c)],delete _0x55ce89['value'][0x0][_0x329525(0x2f0)]):_0x55ce89[_0x329525(0x29c)]=[{'id':_0x55ce89[_0x329525(0x29c)],'display':_0x55ce89[_0x329525(0x29c)]}],delete _0x55ce89['typeId'],_0x521ae9=!![]);}if(_0x3bcdd3[_0x329525(0x29f)]&&Array[_0x329525(0x2e3)](_0x3bcdd3[_0x329525(0x29f)])&&_0x3bcdd3[_0x329525(0x29f)]['length']>0x0){if(!_0x3bcdd3[_0x329525(0x267)])_0x3bcdd3[_0x329525(0x267)]=[];if(!Array[_0x329525(0x2e3)](_0x3bcdd3[_0x329525(0x267)]))_0x3bcdd3['groups']=[];for(let _0x5dd713=0x0;_0x5dd713<_0x3bcdd3['roles'][_0x329525(0x23d)];_0x5dd713++){const _0x11ed81={},_0x2b0188=_0x3bcdd3[_0x329525(0x29f)][_0x5dd713];_0x11ed81[_0x329525(0x29c)]=_0x2b0188[_0x329525(0x29c)],_0x11ed81[_0x329525(0x2af)]=_0x2b0188[_0x329525(0x2f0)]+_0x329525(0x2c4)+_0x2b0188[_0x329525(0x2af)],_0x3bcdd3[_0x329525(0x267)][_0x329525(0x24e)](_0x11ed81);}delete _0x3bcdd3[_0x329525(0x29f)],_0x521ae9=!![];}if(_0x521ae9)_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+'\x20roles\x20converted\x20to\x20groups:\x20'+JSON[_0x329525(0x235)](_0xf4a638));}if(!_0x702b48){if(_0xf4a638[_0x329525(0x233)]===_0x329525(0x27d)){_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+_0x329525(0x216)+_0x391325+'\x20message:\x20user\x20does\x20not\x20exist'),_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+_0x329525(0x230));return;}if(_0x379a2b[_0x329525(0x296)]&&_0x379a2b[_0x329525(0x296)]===!![]){_0x4806c9[_0x329525(0x2f3)]['debug'](_0x3097c2+_0x329525(0x208)+_0x391325+'\x20message:\x20user\x20not\x20created\x20because\x20of\x20configuration\x20modifyOnly=true'),_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+_0x329525(0x230));return;}if(Object[_0x329525(0x1fd)][_0x329525(0x2cf)][_0x329525(0x259)](_0x3bcdd3,_0x329525(0x2b3))){if(typeof _0x3bcdd3[_0x329525(0x2b3)]===_0x329525(0x231)){const _0x274b12=_0x3bcdd3[_0x329525(0x2b3)][_0x329525(0x220)]();if(_0x274b12===_0x329525(0x2fc))_0x3bcdd3[_0x329525(0x2b3)]=!![];else{if(_0x274b12===_0x329525(0x252))_0x3bcdd3[_0x329525(0x2b3)]=![];}}if(_0x3bcdd3[_0x329525(0x2b3)]===![]){_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+_0x329525(0x208)+_0x391325+_0x329525(0x2f9)),_0x4806c9['logger'][_0x329525(0x243)](_0x3097c2+'\x20done');return;}}_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+_0x329525(0x266)+_0x391325);const _0x339850=a0_0x35610e[_0x329525(0x270)](_0x3bcdd3);try{delete _0x339850[_0x329525(0x267)];!_0x339850[_0x329525(0x232)]&&_0x379a2b[_0x329525(0x258)]&&_0x379a2b[_0x329525(0x258)]===!![]&&(_0x339850[_0x329525(0x232)]=a0_0x35610e[_0x329525(0x1fb)](0xf));if(_0x5e2d31||_0x2ea299){if(_0x5e2d31)for(const _0x23709d in _0x5e2d31){_0x339850[_0x23709d]=_0x5e2d31[_0x23709d];}if(_0x2ea299)_0x339850['id']=_0x2ea299;await _0x22e4d6(_0x1f1ff9,_0x339850);}await _0x12a654(_0x1f1ff9,_0x339850),_0x3bcdd3[_0x329525(0x267)]&&Array[_0x329525(0x2e3)](_0x3bcdd3['groups'])&&_0x3bcdd3[_0x329525(0x267)]['length']>0x0&&(_0x29f828=await _0x284394(_0x1f1ff9,_0x329525(0x2b5),_0x391325));}catch(_0x4c453b){_0x4806c9[_0x329525(0x2f3)][_0x329525(0x2ca)](_0x3097c2+_0x329525(0x2d3)+JSON[_0x329525(0x235)](_0x339850)+_0x329525(0x2f1)+_0x4c453b['message']+'}'),_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+_0x329525(0x230));return;}}if(_0x702b48||_0x29f828){if(_0xf4a638['activityOperation']===_0x329525(0x27d)){if(_0x379a2b[_0x329525(0x296)]&&_0x379a2b[_0x329525(0x296)]===!![]){_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+'\x20Delete\x20User\x20id='+_0x702b48+_0x329525(0x245)),_0x4806c9['logger'][_0x329525(0x243)](_0x3097c2+_0x329525(0x230));return;}_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+_0x329525(0x249)+_0x702b48);try{await _0x7ed24c(_0x1f1ff9,_0x702b48);}catch(_0x52708f){_0x4806c9[_0x329525(0x2f3)]['error'](_0x3097c2+_0x329525(0x249)+_0x702b48+_0x329525(0x2f1)+_0x52708f[_0x329525(0x242)]+'}'),_0x4806c9[_0x329525(0x2f3)]['debug'](_0x3097c2+_0x329525(0x230));return;}}else{if(_0x29f828)_0x702b48=_0x29f828;_0x4806c9[_0x329525(0x2f3)]['debug'](_0x3097c2+'\x20Replace\x20User\x20id='+_0x702b48);try{await _0x2855af(_0x329525(0x1f8),_0x1f1ff9,_0x702b48,_0x3bcdd3,_0x379a2b[_0x329525(0x211)]);}catch(_0x1c9cc5){_0x4806c9[_0x329525(0x2f3)][_0x329525(0x2ca)](_0x3097c2+_0x329525(0x29b)+_0x702b48+_0x329525(0x2f1)+_0x1c9cc5['message']),_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+_0x329525(0x230));return;}if(_0x379a2b[_0x329525(0x211)]){const [_0x5d15b4,_0xdfecc6]=a0_0x3a7846[_0x329525(0x1ef)]({'Operations':_0xf4a638[_0x329525(0x2e8)]});if(_0xdfecc6){_0x4806c9[_0x329525(0x2f3)][_0x329525(0x2ca)](_0x3097c2+_0x329525(0x29b)+_0x702b48+_0x329525(0x2e2)+_0xdfecc6[_0x329525(0x242)]),_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+_0x329525(0x230));return;}const _0x1479d4=[];if(_0x5d15b4[_0x329525(0x29f)]&&Array[_0x329525(0x2e3)](_0x5d15b4[_0x329525(0x29f)]))for(let _0x3856e5=0x0;_0x3856e5<_0x5d15b4[_0x329525(0x29f)][_0x329525(0x23d)];_0x3856e5++){_0x5d15b4[_0x329525(0x29f)][_0x3856e5][_0x329525(0x1fc)]&&_0x5d15b4[_0x329525(0x29f)][_0x3856e5][_0x329525(0x1fc)]==='delete'&&_0x1479d4[_0x329525(0x24e)](_0x5d15b4[_0x329525(0x29f)][_0x3856e5]);}if(_0x1479d4[_0x329525(0x23d)]>0x0)try{await _0x4806c9[_0x329525(0x2ce)](_0x1f1ff9,_0x702b48,{'roles':_0x1479d4});}catch(_0x38aa49){_0x4806c9[_0x329525(0x2f3)]['error'](_0x3097c2+_0x329525(0x29b)+_0x702b48+_0x329525(0x308)+_0x38aa49[_0x329525(0x242)]);}const _0x5cf98e=[];if(_0x5d15b4[_0x329525(0x267)]&&Array[_0x329525(0x2e3)](_0x5d15b4['groups']))for(let _0x3126ef=0x0;_0x3126ef<_0x5d15b4[_0x329525(0x267)][_0x329525(0x23d)];_0x3126ef++){_0x5d15b4[_0x329525(0x267)][_0x3126ef][_0x329525(0x1fc)]&&_0x5d15b4[_0x329525(0x267)][_0x3126ef]['operation']===_0x329525(0x29e)&&_0x5cf98e[_0x329525(0x24e)](_0x5d15b4['groups'][_0x3126ef]);}if(_0x5cf98e[_0x329525(0x23d)]>0x0)for(let _0x3f4744=0x0;_0x3f4744<_0x5cf98e[_0x329525(0x23d)];_0x3f4744++){try{await _0x4806c9[_0x329525(0x2dc)](_0x1f1ff9,_0x5cf98e[_0x3f4744]['id'],{'members':[{'operation':_0x329525(0x29e),'value':_0x702b48}]});}catch(_0x467126){_0x4806c9['logger']['error'](_0x3097c2+'\x20Replace\x20User\x20id='+_0x702b48+'\x20group\x20removal\x20error:\x20'+_0x467126[_0x329525(0x242)]);}}}if(_0x379a2b['deleteUserOnLastGroupRoleRemoval']&&_0xf4a638['activityOperation']===_0x329525(0x2ce)){if(_0x3bcdd3[_0x329525(0x267)]&&Array[_0x329525(0x2e3)](_0x3bcdd3['groups'])&&_0x3bcdd3[_0x329525(0x267)]['length']===0x0){if(_0x3bcdd3['roles']&&Array[_0x329525(0x2e3)](_0x3bcdd3[_0x329525(0x29f)])&&_0x3bcdd3[_0x329525(0x29f)][_0x329525(0x23d)]===0x0){if(_0xf4a638[_0x329525(0x2e8)]&&Array['isArray'](_0xf4a638[_0x329525(0x2e8)])&&_0xf4a638['Operations']['length']>0x0){let _0x3d69c4=![];for(let _0x7bfcb2=0x0;_0x7bfcb2<_0xf4a638[_0x329525(0x2e8)][_0x329525(0x23d)];_0x7bfcb2++){const _0x45a90c=_0xf4a638[_0x329525(0x2e8)][_0x7bfcb2];if(_0x45a90c['op']==='remove'){if(_0x45a90c[_0x329525(0x202)]){if(_0x45a90c[_0x329525(0x202)]['startsWith'](_0x329525(0x29f))&&_0x45a90c['typeId']){_0x3d69c4=!![];break;}else{if(_0x45a90c[_0x329525(0x202)]===_0x329525(0x267)){_0x3d69c4=!![];break;}}}}}if(_0x3d69c4){_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+_0x329525(0x249)+_0x702b48);try{await _0x7ed24c(_0x1f1ff9,_0x702b48);}catch(_0x5e2491){_0x4806c9[_0x329525(0x2f3)][_0x329525(0x2ca)](_0x3097c2+_0x329525(0x249)+_0x702b48+_0x329525(0x2f1)+_0x5e2491['message']+'}'),_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+_0x329525(0x230));return;}}}}}}}}_0x4806c9[_0x329525(0x2f3)][_0x329525(0x243)](_0x3097c2+'\x20done');}catch(_0x3c3e8f){_0x4806c9['logger'][_0x329525(0x2ca)](_0x4806c9[_0x329525(0x24d)]+'['+_0x4806c9['pluginName']+']\x20subscriber['+_0x1f1ff9+']['+_0x243918+']\x20error:\x20'+_0x3c3e8f[_0x329525(0x242)]+_0x329525(0x278));}},_0x18e102=jetstream(_0x57e74a),_0x17006f=('durable_'+_0x4806c9[_0x32ab6c(0x271)]+'_'+_0x1f1ff9)[_0x32ab6c(0x244)]('*','#')[_0x32ab6c(0x244)]('>','##')['replaceAll']('.','_'),_0x5824bc=_0x243918[_0x32ab6c(0x24b)]('.')[0x0]['toUpperCase']()==='GW',_0x51eea2=async()=>{const _0x2ce3ce=_0x32ab6c;try{let _0x509025;const _0x25f6fe=''+_0x379a2b?.[_0x2ce3ce(0x1e8)]?.[_0x2ce3ce(0x20c)],_0x5da647=await jetstreamManager(_0x57e74a),_0x40246b=async()=>{const _0xd716=_0x2ce3ce;let _0x10c2b1;try{_0x10c2b1=await _0x18e102[_0xd716(0x26c)][_0xd716(0x24c)](_0x25f6fe,_0x17006f);}catch(_0x2f8073){const _0x24bd4f={'durable_name':_0x17006f,'deliver_policy':DeliverPolicy['All'],'ack_policy':AckPolicy[_0xd716(0x22e)],'filter_subject':_0x243918};await _0x5da647['consumers'][_0xd716(0x304)](_0x25f6fe,_0x24bd4f),_0x10c2b1=await _0x18e102[_0xd716(0x26c)]['get'](_0x25f6fe,_0x17006f);}if(_0x10c2b1?.[_0xd716(0x2c6)]?.[_0xd716(0x2c7)]?.[_0xd716(0x2e1)]!==_0xd716(0x292))throw new Error(_0xd716(0x2c5));_0x10c2b1?.['_info']?.['config']?.['filter_subject']!==_0x243918&&(await _0x5da647['consumers']['update'](_0x25f6fe,_0x17006f,{'filter_subject':_0x243918}),_0x10c2b1=await _0x18e102[_0xd716(0x26c)][_0xd716(0x24c)](_0x25f6fe,_0x17006f)),_0x509025=await _0x10c2b1['consume']({'max_messages':0x64}),_0xd4edd9(_0x509025);},_0xd4edd9=async _0x2abd89=>{const _0x425864=_0x2ce3ce;for await(const _0x1ba9d5 of await _0x2abd89[_0x425864(0x262)]()){switch(_0x1ba9d5['type']){case _0x425864(0x260):_0x4806c9[_0x425864(0x2f3)]['info'](_0x4806c9['gwName']+'['+_0x4806c9[_0x425864(0x271)]+_0x425864(0x1f9)+_0x1f1ff9+']['+_0x243918+_0x425864(0x2bf)+_0x1ba9d5[_0x425864(0x2f0)]),_0x40246b();return;}}};await _0x40246b();let _0x222fb8=-0x1;do{for await(const _0x2ebd5e of _0x509025){if(!_0x2ebd5e[_0x2ce3ce(0x237)]||!_0x2ebd5e[_0x2ce3ce(0x237)][_0x2ce3ce(0x24c)]('Msg-Id')){_0x2ebd5e[_0x2ce3ce(0x246)]();continue;}_0x222fb8=_0x509025['getProcessed']();const _0x3c7f71=_0x4806c9[_0x2ce3ce(0x24d)]+'['+_0x4806c9[_0x2ce3ce(0x271)]+']\x20subscriber['+_0x1f1ff9+']['+_0x2ebd5e[_0x2ce3ce(0x27a)]+']['+_0x222fb8+']['+(_0x2ebd5e[_0x2ce3ce(0x237)]?_0x2ebd5e['headers'][_0x2ce3ce(0x24c)]('Msg-Id'):'')+']',_0x5f251c=_0x2ebd5e[_0x2ce3ce(0x231)](),_0x1d1183=await _0x5b325e(_0x3c7f71,_0x5f251c);if(!_0x1d1183||_0x1d1183!==!![])_0x2ebd5e[_0x2ce3ce(0x246)]();else _0x4806c9[_0x2ce3ce(0x2f3)]['error'](_0x3c7f71+'\x20subscriber\x20error:\x20scimgateway\x20endpoint\x20connect\x20problem\x20-\x20will\x20do\x20auto\x20retry\x20until\x20connected');if(_0x222fb8<0x1)break;}}while(_0x222fb8===0x0);}catch(_0x365630){_0x4806c9[_0x2ce3ce(0x2f3)]['error'](_0x4806c9['gwName']+'['+_0x4806c9[_0x2ce3ce(0x271)]+']\x20subscriber['+_0x1f1ff9+']['+_0x243918+_0x2ce3ce(0x25d)+_0x365630[_0x2ce3ce(0x242)]);}},_0x2068c7=async()=>{const _0xeec2d1=_0x32ab6c,_0x50d238=_0x57e74a[_0xeec2d1(0x2df)](_0x243918,{'max':0x64});for await(const _0x1739ab of _0x50d238){const _0x47ffd0=_0x1739ab['headers']['get']('Msg-Id');if(!_0x1739ab[_0xeec2d1(0x237)]||!_0x47ffd0)continue;const _0xc5b169=_0x4806c9['gwName']+'['+_0x4806c9[_0xeec2d1(0x271)]+_0xeec2d1(0x1f9)+_0x1f1ff9+']['+_0x1739ab[_0xeec2d1(0x27a)]+']['+(_0x1739ab[_0xeec2d1(0x237)]?_0x47ffd0:'')+']';_0x4806c9['logger'][_0xeec2d1(0x243)](_0xc5b169+_0xeec2d1(0x2c1));const _0x285191={'func':'','id':'','obj':''};let _0x475d31;try{try{_0x475d31=JSON['parse'](_0x1739ab[_0xeec2d1(0x231)]());}catch(_0x59ff4b){const _0x58ca2a=_0xeec2d1(0x1f6);_0x4806c9['logger'][_0xeec2d1(0x2ca)](_0x4806c9[_0xeec2d1(0x24d)]+'['+_0x4806c9[_0xeec2d1(0x271)]+_0xeec2d1(0x1f9)+_0x1f1ff9+']['+_0x243918+']\x20'+_0x58ca2a+':\x20'+_0x1739ab[_0xeec2d1(0x231)]());throw new Error(_0x58ca2a);}const _0x586c20=_0x475d31['ctx'];if(_0x586c20?.['routeObj']?.['id'])_0x285191['id']=_0x586c20['routeObj']['id'];if(_0x586c20?.[_0xeec2d1(0x27e)]?.[_0xeec2d1(0x29a)])_0x285191[_0xeec2d1(0x2a6)]=a0_0x35610e[_0xeec2d1(0x270)](_0x586c20['request'][_0xeec2d1(0x29a)]);if(_0x586c20?.[_0xeec2d1(0x27e)]?.[_0xeec2d1(0x237)]?.[_0xeec2d1(0x297)]){const _0x61094f=_0x586c20[_0xeec2d1(0x27e)][_0xeec2d1(0x237)][_0xeec2d1(0x297)];if(_0x61094f)_0x586c20[_0xeec2d1(0x27e)][_0xeec2d1(0x237)][_0xeec2d1(0x297)]=a0_0x35610e[_0xeec2d1(0x1f3)](_0x61094f,_0x47ffd0);}if(_0x586c20?.[_0xeec2d1(0x2ea)]?.[_0xeec2d1(0x237)]?.[_0xeec2d1(0x297)]){const _0x57c842=_0x586c20[_0xeec2d1(0x2ea)][_0xeec2d1(0x237)][_0xeec2d1(0x297)];if(_0x57c842)_0x586c20[_0xeec2d1(0x2ea)][_0xeec2d1(0x237)]['authorization']=a0_0x35610e[_0xeec2d1(0x1f3)](_0x57c842,_0x47ffd0);}if(_0x4806c9[_0xeec2d1(0x2c7)][_0xeec2d1(0x28a)][_0xeec2d1(0x293)])await _0x1bdbdb(_0x586c20);else{const _0x476751=_0x586c20?.[_0xeec2d1(0x27c)]?.[_0xeec2d1(0x307)]+'\x20'+_0x586c20?.[_0xeec2d1(0x27c)]?.[_0xeec2d1(0x228)];_0x285191['func']=_0x476751;switch(_0x476751){case'GET\x20users':case _0xeec2d1(0x2a0):case _0xeec2d1(0x2fa):if(_0x586c20[_0xeec2d1(0x27c)]['id'])await _0x8631[_0xeec2d1(0x274)](_0x586c20);else await _0x8631['getHandler'](_0x586c20);break;case _0xeec2d1(0x277):await _0x8631['getApiHandler'](_0x586c20);break;case _0xeec2d1(0x27b):await _0x8631[_0xeec2d1(0x282)](_0x586c20);break;case _0xeec2d1(0x28d):case'GET\x20serviceproviderconfigs':await _0x8631[_0xeec2d1(0x26d)](_0x586c20);break;case'PATCH\x20users':case _0xeec2d1(0x241):await _0x8631[_0xeec2d1(0x24a)](_0x586c20);break;case _0xeec2d1(0x2ac):await _0x8631[_0xeec2d1(0x1fe)](_0x586c20);break;case _0xeec2d1(0x30a):case _0xeec2d1(0x2b1):await _0x8631[_0xeec2d1(0x26a)](_0x586c20);break;case'PUT\x20api':await _0x8631[_0xeec2d1(0x269)](_0x586c20);break;case _0xeec2d1(0x229):case _0xeec2d1(0x263):await _0x8631[_0xeec2d1(0x212)](_0x586c20);break;case _0xeec2d1(0x22a):await _0x8631[_0xeec2d1(0x248)](_0x586c20);break;case _0xeec2d1(0x23c):case _0xeec2d1(0x284):await _0x8631['deleteHandler'](_0x586c20);break;case _0xeec2d1(0x294):await _0x8631['deleteApiHandler'](_0x586c20);break;default:_0x586c20[_0xeec2d1(0x2ef)]=new Response(_0xeec2d1(0x21c),{'status':0x194});}}if(!_0x586c20['response'])_0x586c20[_0xeec2d1(0x2ef)]=null;const _0x10a204=JSON[_0xeec2d1(0x235)](_0x586c20[_0xeec2d1(0x2ef)]);_0x1739ab[_0xeec2d1(0x20e)](_0x10a204),_0x4806c9[_0xeec2d1(0x2f3)][_0xeec2d1(0x2f7)](_0xc5b169+_0xeec2d1(0x2a3)+_0x285191[_0xeec2d1(0x2aa)]+_0xeec2d1(0x2bd)+(_0x285191[_0xeec2d1(0x2a6)]?JSON[_0xeec2d1(0x235)](_0x285191['obj']):'')+_0xeec2d1(0x218)+(_0x285191['id']?_0x285191['id']:'')+'}\x20message\x20response:\x20'+_0x10a204);}catch(_0x5b05bf){const _0x38fb4c=_0xeec2d1(0x20b)+_0x5b05bf[_0xeec2d1(0x242)]+'\x22,\x22errName\x22:\x22'+_0x5b05bf[_0xeec2d1(0x2ae)]+'\x22}';_0x1739ab[_0xeec2d1(0x20e)](_0x38fb4c),_0x4806c9[_0xeec2d1(0x2f3)][_0xeec2d1(0x2f7)]((_0xc5b169||'')+'\x20message\x20handled:\x20'+_0x285191['func']+',\x20obj='+(_0x285191[_0xeec2d1(0x2a6)]?JSON[_0xeec2d1(0x235)](_0x285191[_0xeec2d1(0x2a6)]):'')+',\x20id='+(_0x285191['id']?_0x285191['id']:'')+_0xeec2d1(0x25c)+_0x38fb4c);}}};if(_0x5824bc)_0x2068c7();else _0x51eea2();},_0x1e2800=async(_0x293fd6,_0x4df4a9)=>{const _0x2a7096=_0xbd1d74,_0x5dc127=_0x15dd9a[_0x293fd6]['config']?.[_0x2a7096(0x1e8)]?.['subject'];let _0x155a4a=0x0;for await(const _0x192dac of _0x4df4a9[_0x2a7096(0x262)]()){switch(_0x192dac[_0x2a7096(0x2f0)]){case'disconnect':_0x4806c9[_0x2a7096(0x2f3)][_0x2a7096(0x2ca)](_0x4806c9[_0x2a7096(0x24d)]+'['+_0x4806c9[_0x2a7096(0x271)]+_0x2a7096(0x1f9)+_0x293fd6+']['+_0x5dc127+_0x2a7096(0x2be)+_0x192dac['data']+'\x20-\x20will\x20do\x20auto\x20reconnect\x20when\x20connection\x20becomes\x20available'),_0x155a4a=0x0;break;case _0x2a7096(0x204):_0x4806c9[_0x2a7096(0x2f3)][_0x2a7096(0x2f7)](_0x4806c9[_0x2a7096(0x24d)]+'['+_0x4806c9[_0x2a7096(0x271)]+']\x20subscriber['+_0x293fd6+']['+_0x5dc127+_0x2a7096(0x215)+_0x192dac['data']);break;case'error':_0x4806c9[_0x2a7096(0x2f3)]['error'](_0x4806c9[_0x2a7096(0x24d)]+'['+_0x4806c9[_0x2a7096(0x271)]+_0x2a7096(0x1f9)+_0x293fd6+']['+_0x5dc127+']\x20client\x20error\x20'+_0x192dac[_0x2a7096(0x2ad)]);break;case _0x2a7096(0x306):_0x155a4a+=0x1;_0x155a4a%0x1e===0x0&&_0x4806c9[_0x2a7096(0x2f3)][_0x2a7096(0x243)](_0x4806c9[_0x2a7096(0x24d)]+'['+_0x4806c9['pluginName']+_0x2a7096(0x1f9)+_0x293fd6+']['+_0x5dc127+_0x2a7096(0x200)+_0x192dac['data']+_0x2a7096(0x1ea)+_0x155a4a+')');break;case'staleConnection':_0x4806c9['logger'][_0x2a7096(0x243)](_0x4806c9[_0x2a7096(0x24d)]+'['+_0x4806c9[_0x2a7096(0x271)]+_0x2a7096(0x1f9)+_0x293fd6+']['+_0x5dc127+_0x2a7096(0x27f)+_0x192dac[_0x2a7096(0x2ad)]);break;}}};process['on'](_0xbd1d74(0x23e),async()=>{const _0x2d3b72=_0xbd1d74;for(const _0x25cb01 in _0x15dd9a){_0x15dd9a[_0x25cb01]['nc']&&!_0x15dd9a[_0x25cb01]['nc'][_0x2d3b72(0x2b9)]()&&await _0x15dd9a[_0x25cb01]['nc']['drain']();}}),process['on'](_0xbd1d74(0x2cb),async()=>{const _0xa7a69e=_0xbd1d74;for(const _0x8ae4a3 in _0x15dd9a){_0x15dd9a[_0x8ae4a3]['nc']&&!_0x15dd9a[_0x8ae4a3]['nc'][_0xa7a69e(0x2b9)]()&&await _0x15dd9a[_0x8ae4a3]['nc'][_0xa7a69e(0x226)]();}});const _0x284394=async(_0x373295,_0x3f94ef,_0x418a2a)=>{const _0x2993fd=_0xbd1d74,_0x4f0335={'attribute':_0x3f94ef,'operator':'eq','value':_0x418a2a,'rawFilter':undefined,'startIndex':undefined,'count':undefined},_0x1b6966=[_0x3f94ef];if(_0x3f94ef!=='id')_0x1b6966[_0x2993fd(0x24e)]('id');try{const _0x1be6e3=await _0xfeebec(_0x373295,_0x4f0335,_0x1b6966);if(!_0x1be6e3||!_0x1be6e3['Resources']||!Array[_0x2993fd(0x2e3)](_0x1be6e3[_0x2993fd(0x253)]))throw new Error(_0x2993fd(0x221)+JSON['stringify'](_0x4f0335)+_0x2993fd(0x281));if(_0x1be6e3[_0x2993fd(0x253)][_0x2993fd(0x23d)]===0x0)return null;else{if(_0x1be6e3[_0x2993fd(0x253)][_0x2993fd(0x23d)]>0x2)throw new Error(_0x2993fd(0x221)+JSON[_0x2993fd(0x235)](_0x4f0335)+_0x2993fd(0x2fd));else{const _0xe296f6=_0x1be6e3[_0x2993fd(0x253)][0x0];if(!_0xe296f6['id'])throw new Error(_0x2993fd(0x221)+JSON['stringify'](_0x4f0335)+_0x2993fd(0x280)+JSON[_0x2993fd(0x235)](_0xe296f6)+_0x2993fd(0x303));return decodeURIComponent(_0xe296f6['id']);}}}catch(_0x39efd3){throw new Error(_0x2993fd(0x221)+JSON['stringify'](_0x4f0335)+'\x20error:\x20'+_0x39efd3[_0x2993fd(0x242)]+'}');}},_0xfeebec=async(_0x58bcb0,_0xdaa18c,_0x51f848)=>{const _0x584a70=_0xbd1d74;if(!_0x76894b)return await _0x4806c9[_0x584a70(0x279)](_0x58bcb0,_0xdaa18c,_0x51f848);if(!_0xdaa18c?.[_0x584a70(0x223)]||_0xdaa18c[_0x584a70(0x223)]!=='eq')throw new Error('getUsers()\x20error:\x20unsupported\x20operator\x20for\x20getObj:\x20'+JSON['stringify'](_0xdaa18c));if(_0x58bcb0===_0x584a70(0x295))_0x58bcb0=undefined;let _0x3df504=_0x58bcb0?'/'+_0x58bcb0+_0x584a70(0x22b):_0x584a70(0x22b);if(_0xdaa18c['attribute']==='id'){_0x3df504+='/'+_0xdaa18c[_0x584a70(0x29c)];if(_0x51f848&&_0x51f848[_0x584a70(0x23d)]>0x0)_0x3df504+='?attributes='+_0x51f848[_0x584a70(0x2a7)](',');}else{if(_0xdaa18c[_0x584a70(0x29d)]===_0x584a70(0x2b5)){_0x3df504+=_0x584a70(0x1ed)+_0xdaa18c[_0x584a70(0x29c)]+'\x22';if(_0x51f848&&_0x51f848[_0x584a70(0x23d)]>0x0)_0x3df504+=_0x584a70(0x2a8)+_0x51f848[_0x584a70(0x2a7)](',');}else{if(_0xdaa18c[_0x584a70(0x29d)]===_0x584a70(0x250)){_0x3df504+=_0x584a70(0x25b)+_0xdaa18c[_0x584a70(0x29c)]+'\x22';if(_0x51f848&&_0x51f848[_0x584a70(0x23d)]>0x0)_0x3df504+='&attributes='+_0x51f848['join'](',');}else throw new Error('getUsers()\x20error:\x20unsupported\x20operator\x20for\x20getObj:\x20'+JSON[_0x584a70(0x235)](_0xdaa18c));}}return await _0x5595a9(_0x58bcb0,_0x584a70(0x257),_0x3df504);},_0x12a654=async(_0xd574aa,_0x3969ae)=>{const _0x2979a5=_0xbd1d74;if(!_0x76894b)return await _0x4806c9['createUser'](_0xd574aa,_0x3969ae);if(_0xd574aa==='undefined')_0xd574aa=undefined;const _0x2c8d78=_0xd574aa?'/'+_0xd574aa+_0x2979a5(0x22b):_0x2979a5(0x22b);return await _0x5595a9(_0xd574aa,_0x2979a5(0x2c3),_0x2c8d78,_0x3969ae);},_0x2855af=async(_0x4c1232,_0x3cd69e,_0x3116a5,_0x3fedce,_0x52c972)=>{const _0x4fdfab=_0xbd1d74;if(!_0x4c1232||_0x4c1232[_0x4fdfab(0x220)]()!=='users')throw new Error(_0x4fdfab(0x219));if(!_0x76894b)return await _0x8631[_0x4fdfab(0x251)](_0x4fdfab(0x1f8),_0x3cd69e,_0x3116a5,_0x3fedce,_0x52c972);if(_0x3cd69e===_0x4fdfab(0x295))_0x3cd69e=undefined;const _0x22daf0=_0x3cd69e?'/'+_0x3cd69e+_0x4fdfab(0x1f4)+_0x3116a5:_0x4fdfab(0x1f4)+_0x3116a5;return await _0x5595a9(_0x3cd69e,'PUT',_0x22daf0,_0x3fedce);},_0x7ed24c=async(_0x5a1248,_0xa0e162)=>{const _0x46e820=_0xbd1d74;!_0x76894b&&await _0x4806c9[_0x46e820(0x27d)](_0x5a1248,_0xa0e162);if(_0x5a1248==='undefined')_0x5a1248=undefined;const _0x47473b=_0x5a1248?'/'+_0x5a1248+_0x46e820(0x1f4)+_0xa0e162:_0x46e820(0x1f4)+_0xa0e162;return await _0x5595a9(_0x5a1248,_0x46e820(0x1e7),_0x47473b);},_0x2b0ac8=_0x4cec86=>{const _0x26afba=_0xbd1d74;if(!_0x4cec86||typeof _0x4cec86!==_0x26afba(0x231))return[null,null];_0x4cec86=_0x4cec86[_0x26afba(0x23f)]();const _0x474f94=_0x4cec86[_0x26afba(0x26f)]('(');if(_0x474f94<0x1)return[null,null];if(_0x4cec86[_0x26afba(0x2d9)](_0x4cec86[_0x26afba(0x23d)]-0x1)!==')')return[null,null];if(_0xc08aef(_0x4cec86,'(')!==_0xc08aef(_0x4cec86,')'))return[null,null];const _0x18e9f7=_0x4cec86['substring'](0x0,_0x474f94),_0x55bade=_0x4cec86[_0x26afba(0x2d9)](_0x474f94+0x1,_0x4cec86[_0x26afba(0x23d)]-0x1);let _0x52b6d7=[];const _0x56e207=_0x55bade['split'](',');let _0xd6f7f8='';for(let _0x23a6ea=0x0;_0x23a6ea<_0x56e207[_0x26afba(0x23d)];_0x23a6ea++){const _0x242126=_0xd6f7f8?_0xd6f7f8+','+_0x56e207[_0x23a6ea]:_0x56e207[_0x23a6ea],_0x38c44a=_0xc08aef(_0x242126,'('),_0x156958=_0xc08aef(_0x242126,')');if(_0x38c44a===_0x156958)_0x52b6d7[_0x26afba(0x24e)](_0x110104(_0x242126,'\x22')),_0xd6f7f8='';else{if(_0xd6f7f8)_0xd6f7f8+=','+_0x56e207[_0x23a6ea];else _0xd6f7f8+=_0x56e207[_0x23a6ea];}}if(_0x52b6d7[_0x26afba(0x23d)]===0x0)_0x52b6d7=null;return[_0x18e9f7,_0x52b6d7];};function _0xc08aef(_0x12aa76,_0x3d2593){const _0x5a73f1=_0xbd1d74;let _0x1acc48=0x0;for(let _0x3be7b2=0x0;_0x3be7b2<_0x12aa76[_0x5a73f1(0x23d)];_0x3be7b2++){_0x12aa76[_0x5a73f1(0x2c0)](_0x3be7b2)===_0x3d2593&&(_0x1acc48+=0x1);}return _0x1acc48;}const _0x110104=(_0x10eaef,_0x67ecef)=>{const _0x3b044e=_0xbd1d74;if(typeof _0x10eaef!==_0x3b044e(0x231)||typeof _0x67ecef!==_0x3b044e(0x231))return _0x10eaef;if(_0x10eaef[_0x3b044e(0x23d)]===0x1)return _0x10eaef;if(_0x67ecef['length']!==0x1)return _0x10eaef;return _0x10eaef=_0x10eaef[_0x3b044e(0x23f)](),_0x10eaef['substring'](0x0,0x1)===_0x67ecef&&(_0x10eaef=_0x10eaef[_0x3b044e(0x2d9)](0x1)),_0x10eaef[_0x3b044e(0x2d9)](_0x10eaef[_0x3b044e(0x23d)]-0x1)===_0x67ecef&&(_0x10eaef=_0x10eaef[_0x3b044e(0x2d9)](0x0,_0x10eaef[_0x3b044e(0x23d)]-0x1)),_0x10eaef;},_0xb8a001=async(_0x27a4e0,_0x45d350,_0x36bd06,_0x531f5a)=>{const _0x146c45=_0xbd1d74;if(!_0x45d350||!_0x36bd06||!_0x531f5a)return null;const [_0x245559,_0x237814]=_0x2b0ac8(_0x531f5a);if(!_0x245559||!_0x237814){const _0x10f9cf=_0x531f5a[_0x146c45(0x24b)]('(');if(_0x10f9cf['length']>0x1){const _0x33e1ce=[_0x146c45(0x300),'uppercase','firstn',_0x146c45(0x289),_0x146c45(0x2a7),_0x146c45(0x288),'normalize','increment',_0x146c45(0x291)],_0x3daec1=_0x10f9cf[0x0]['toLowerCase']();if(_0x33e1ce[_0x146c45(0x205)](_0x3daec1))return null;}return _0x531f5a;}for(let _0x469e2e=0x0;_0x469e2e<_0x237814[_0x146c45(0x23d)];_0x469e2e++){if(_0x237814[_0x469e2e][_0x146c45(0x2d9)](0x0,0x1)==='['){const _0x816e4a=_0x237814[_0x469e2e][_0x146c45(0x26f)](']');if(_0x816e4a<0x0)return null;const _0x1116a1=_0x237814[_0x469e2e][_0x146c45(0x2d9)](0x1,_0x816e4a),_0x2cbdf5=_0x1116a1['split']('.');let _0x3e47c9;for(let _0x9edcfb=0x0;_0x9edcfb<_0x2cbdf5['length'];_0x9edcfb++){if(_0x9edcfb===0x0)_0x3e47c9=_0x45d350[_0x2cbdf5[_0x9edcfb]];else{if(!_0x3e47c9)return null;_0x3e47c9=_0x3e47c9[_0x2cbdf5[_0x9edcfb]];}}if(!_0x3e47c9)return null;_0x237814[_0x469e2e]=_0x3e47c9;}}for(let _0x1d3784=0x0;_0x1d3784<_0x237814[_0x146c45(0x23d)];_0x1d3784++){const [_0x1db4e4]=_0x2b0ac8(_0x237814[_0x1d3784]);_0x1db4e4&&(_0x237814[_0x1d3784]=await _0xb8a001(_0x27a4e0,_0x45d350,_0x36bd06,_0x237814[_0x1d3784]));}if(_0x237814[0x0]===null)return null;switch(_0x245559[_0x146c45(0x220)]()){case'lowercase':{if(_0x237814['length']!==0x1)return null;const [_0x3aa752]=_0x2b0ac8(_0x237814[0x0]);if(_0x3aa752)_0x237814[0x0]=await _0xb8a001(_0x27a4e0,_0x45d350,_0x36bd06,_0x3aa752);if(_0x237814[0x0]===null)return null;return _0x237814[0x0][_0x146c45(0x220)]();}case _0x146c45(0x2eb):{if(_0x237814[_0x146c45(0x23d)]!==0x1)return null;const [_0x560ca8]=_0x2b0ac8(_0x237814[0x0]);if(_0x560ca8)_0x237814[0x0]=await _0xb8a001(_0x27a4e0,_0x45d350,_0x36bd06,_0x560ca8);if(_0x237814[0x0]===null)return null;return _0x237814[0x0][_0x146c45(0x285)]();}case'firstn':{if(_0x237814[_0x146c45(0x23d)]!==0x2)return null;const [_0x2edf3d]=_0x2b0ac8(_0x237814[0x0]);if(_0x2edf3d)_0x237814[0x0]=await _0xb8a001(_0x27a4e0,_0x45d350,_0x36bd06,_0x2edf3d);if(_0x237814[0x0]===null)return null;if(isNaN(_0x237814[0x1]))return null;return _0x237814[0x0][_0x146c45(0x2d9)](0x0,_0x237814[0x1]);}case _0x146c45(0x289):{const [_0x13ff33]=_0x2b0ac8(_0x237814[0x0]);if(_0x237814[_0x146c45(0x23d)]<0x2)return null;if(_0x13ff33)_0x237814[0x0]=await _0xb8a001(_0x27a4e0,_0x45d350,_0x36bd06,_0x13ff33);if(_0x237814[0x0]===null)return null;const _0x125620=_0x237814[0x1];if(isNaN(_0x125620))return null;let _0xcbe8a4;if(_0x237814[_0x146c45(0x23d)]===0x3)_0xcbe8a4=_0x237814[0x0][_0x146c45(0x24b)](_0x237814[0x2]);else _0xcbe8a4=_0xcbe8a4=_0x237814[0x0][_0x146c45(0x24b)]('\x20');if(_0x125620<=_0xcbe8a4[_0x146c45(0x23d)])return _0xcbe8a4[_0x125620-0x1];else return'';}case'replace':{const [_0x5446a6]=_0x2b0ac8(_0x237814[0x0]);if(_0x5446a6)_0x237814[0x0]=await _0xb8a001(_0x27a4e0,_0x45d350,_0x36bd06,_0x5446a6);if(_0x237814[0x0]===null)return null;if(_0x237814['length']!==0x3)return null;return _0x237814[0x0][_0x146c45(0x244)](_0x237814[0x1],_0x237814[0x2]);}case _0x146c45(0x2f8):{if(_0x237814[_0x146c45(0x23d)]!==0x1)return null;const [_0x556705]=_0x2b0ac8(_0x237814[0x0]);if(_0x556705)_0x237814[0x0]=await _0xb8a001(_0x27a4e0,_0x45d350,_0x36bd06,_0x556705);if(_0x237814[0x0]===null)return null;return a0_0x2bce72[_0x146c45(0x26e)](_0x237814[0x0]);}case _0x146c45(0x2a7):{let _0x4728d1='';for(let _0x573dda=0x0;_0x573dda<_0x237814['length'];_0x573dda++){const [_0x58a5ef]=_0x2b0ac8(_0x237814[_0x573dda]);if(_0x58a5ef)_0x237814[_0x573dda]=await _0xb8a001(_0x27a4e0,_0x45d350,_0x36bd06,_0x58a5ef);if(_0x237814[_0x573dda]===null)return null;_0x4728d1+=_0x237814[_0x573dda];}return _0x4728d1;}case _0x146c45(0x2b2):{if(_0x237814[_0x146c45(0x23d)]>0x2)return null;const [_0x531879]=_0x2b0ac8(_0x237814[0x0]);if(_0x531879)_0x237814[0x0]=await _0xb8a001(_0x27a4e0,_0x45d350,_0x36bd06,_0x531879);if(_0x237814[0x0]===null)return null;const _0x1778a9=parseInt(_0x237814[0x0]);if(isNaN(_0x1778a9))return null;let _0x1c598d=_0x146c45(0x25e);_0x1c598d+=','+_0x237814[0x0];if(_0x237814[_0x146c45(0x23d)]===0x2&&_0x237814[0x1]['toLowerCase']()===_0x146c45(0x2fc))_0x1c598d+=_0x146c45(0x272);else _0x1c598d+=_0x146c45(0x224);return _0x1c598d+='##',_0x1c598d;}case _0x146c45(0x291):{if(_0x237814[_0x146c45(0x23d)]!==0x1)return null;const [_0x10e958]=_0x2b0ac8(_0x237814[0x0]);if(_0x10e958)_0x237814[0x0]=await _0xb8a001(_0x27a4e0,_0x45d350,_0x36bd06,_0x10e958);if(_0x237814[0x0]===null)return null;let _0x4dbed9,_0x2d7982=![],_0x2ee6e4='';const _0x5b56a4=_0x237814[0x0][_0x146c45(0x24b)]('##');if(_0x5b56a4[_0x146c45(0x23d)]>0x2)for(let _0x3f44e3=0x0;_0x3f44e3<_0x5b56a4[_0x146c45(0x23d)];_0x3f44e3++){if(_0x5b56a4[_0x3f44e3][_0x146c45(0x2e6)](_0x146c45(0x2a2))){const _0x31da8e=_0x5b56a4[_0x3f44e3][_0x146c45(0x24b)](',');if(_0x31da8e[_0x146c45(0x23d)]<0x2)return null;const _0x44a96a=parseInt(_0x31da8e[0x1]);if(isNaN(_0x44a96a))return null;_0x2ee6e4='##'+_0x5b56a4[_0x3f44e3]+'##',_0x4dbed9=_0x31da8e[0x1],_0x31da8e['length']>0x2&&(_0x2d7982=_0x31da8e[0x2][_0x146c45(0x220)]()===_0x146c45(0x2fc));}}let _0x5e8fb2,_0x48cdc7=0x0,_0x53f9f5=0x0;if(_0x4dbed9){_0x53f9f5=_0x4dbed9['length'],_0x48cdc7=0xa;for(let _0xf82ea7=0x1;_0xf82ea7<_0x53f9f5;_0xf82ea7++){_0x48cdc7*=0xa;}_0x48cdc7-=0x1,_0x5e8fb2=parseInt(_0x4dbed9);if(isNaN(_0x5e8fb2))return null;_0x5e8fb2-=0x1;}else _0x5e8fb2=0x0;do{_0x5e8fb2+=0x1;let _0x194b50=_0x237814[0x0];if(_0x4dbed9!==undefined&&_0x2ee6e4){let _0x2891f8=_0x5e8fb2[_0x146c45(0x2c9)]();while(_0x2891f8[_0x146c45(0x23d)]<_0x53f9f5){_0x2891f8='0'+_0x2891f8;}_0x2d7982?_0x194b50=_0x194b50[_0x146c45(0x288)](_0x2ee6e4,_0x2891f8):(_0x194b50=_0x194b50[_0x146c45(0x288)](_0x2ee6e4,''),_0x2d7982=!![],_0x5e8fb2-=0x1);}try{const _0x3652c3=await _0x284394(_0x27a4e0,_0x36bd06,_0x194b50);if(!_0x3652c3)return _0x194b50;}catch(_0x2f3dda){return _0x4806c9[_0x146c45(0x2f3)]['error'](_0x4806c9['gwName']+'['+_0x4806c9['pluginName']+']\x20'+_0x245559+_0x146c45(0x2f4)+_0x2f3dda['message']),null;}}while(_0x5e8fb2<_0x48cdc7);return null;}default:}return null;},_0x22e4d6=async(_0xe93a1b,_0x198fa0)=>{const _0x2be15a=_0xbd1d74;for(const _0x461c90 in _0x198fa0){const _0x2868e8=_0x198fa0[_0x461c90],[_0x57192d,_0x258e74]=_0x2b0ac8(_0x2868e8);if(_0x57192d){const _0x33657b=''+_0x461c90,_0x45cd4e=_0x57192d+'('+_0x258e74[_0x2be15a(0x2a7)](',')+')',_0x281e04=await _0xb8a001(_0xe93a1b,_0x198fa0,_0x33657b,_0x45cd4e);if(_0x281e04===null)delete _0x198fa0[_0x461c90];else _0x198fa0[_0x461c90]=_0x281e04;}for(const _0x4e461e in _0x2868e8){const _0x80cb55=_0x2868e8[_0x4e461e],[_0x5ef590,_0xc4d16b]=_0x2b0ac8(_0x80cb55);if(_0x5ef590){const _0x3e2d81=_0x461c90+'.'+_0x4e461e,_0x557b53=_0x5ef590+'('+_0xc4d16b[_0x2be15a(0x2a7)](',')+')',_0x18ea42=await _0xb8a001(_0xe93a1b,_0x198fa0,_0x3e2d81,_0x557b53);if(_0x18ea42===null)delete _0x2868e8[_0x4e461e];else _0x2868e8[_0x4e461e]=_0x18ea42;}}}return _0x198fa0;},_0x5595a9=async(_0x2bb53c,_0x43161b,_0x56bafa,_0x3ca87a)=>{const _0x5dba94=_0xbd1d74;if(!_0x76894b)throw new Error('streamChaining\x20called\x20but\x20missing\x20chainingBaseUrl');if(!_0x12a8e9)throw new Error('subscriber\x20using\x20remote\x20gateway\x20through\x20chainingBaseUrl\x20requires\x20either\x20auth.tokenBearer\x20or\x20auth.basic\x20to\x20be\x20configured');try{if(!_0x4806c9[_0x5dba94(0x256)])_0x4806c9['helperRest']=_0x4806c9['newHelperRest']();const _0x3eafca={'headers':{'Authorization':_0x12a8e9}},_0x1b25e9=await _0x4806c9[_0x5dba94(0x256)][_0x5dba94(0x2c8)](undefined,_0x43161b,_0x76894b+_0x56bafa,_0x3ca87a,undefined,_0x3eafca);return _0x1b25e9['body'];}catch(_0x4e03e4){try{const _0x180fee=JSON['parse'](_0x4e03e4[_0x5dba94(0x242)]);if(_0x180fee[_0x5dba94(0x29a)])throw new Error(JSON[_0x5dba94(0x235)](_0x180fee[_0x5dba94(0x29a)]));throw new Error(_0x4e03e4[_0x5dba94(0x242)]);}catch(_0x4f8ae3){throw new Error(_0x5dba94(0x2d8)+_0x4f8ae3[_0x5dba94(0x242)]);}}},_0x1bdbdb=async _0x312c3f=>{const _0x3396a1=_0xbd1d74,_0x224581=_0x4806c9[_0x3396a1(0x2c7)][_0x3396a1(0x28a)][_0x3396a1(0x293)];if(!_0x224581){_0x312c3f['response'][_0x3396a1(0x262)]=0x1f4,_0x4806c9[_0x3396a1(0x2f3)][_0x3396a1(0x2ca)](_0x4806c9['gwName']+'['+_0x4806c9['pluginName']+_0x3396a1(0x209));return;}try{new URL(_0x224581);}catch(_0x581a36){_0x312c3f[_0x3396a1(0x2ef)][_0x3396a1(0x262)]=0x1f4,_0x4806c9[_0x3396a1(0x2f3)][_0x3396a1(0x2ca)](_0x4806c9['gwName']+'['+_0x4806c9[_0x3396a1(0x271)]+_0x3396a1(0x222)+_0x581a36['message']);return;}try{if(!_0x4806c9[_0x3396a1(0x256)])_0x4806c9[_0x3396a1(0x256)]=_0x4806c9[_0x3396a1(0x1f7)]();const _0x5d56f5=new URL(_0x312c3f[_0x3396a1(0x27e)][_0x3396a1(0x1eb)]),_0x433506=_0x312c3f[_0x3396a1(0x27e)][_0x3396a1(0x307)],_0x14d524=_0x312c3f[_0x3396a1(0x27e)][_0x3396a1(0x1eb)]['replace'](_0x5d56f5['origin'],_0x224581),_0x421ff7=_0x312c3f[_0x3396a1(0x27e)][_0x3396a1(0x29a)],_0x1f8145={'headers':{'Authorization':_0x312c3f['request'][_0x3396a1(0x237)][_0x3396a1(0x297)]}},_0xaf0d80=await _0x4806c9['helperRest'][_0x3396a1(0x2c8)](_0x3396a1(0x295),_0x433506,_0x14d524,_0x421ff7,undefined,_0x1f8145);_0x312c3f[_0x3396a1(0x2ef)][_0x3396a1(0x262)]=_0xaf0d80[_0x3396a1(0x20d)];try{_0x312c3f[_0x3396a1(0x2ef)][_0x3396a1(0x29a)]=JSON['stringify'](_0xaf0d80[_0x3396a1(0x29a)]);}catch(_0x17b9d7){_0x312c3f['response'][_0x3396a1(0x29a)]=_0xaf0d80[_0x3396a1(0x29a)];}}catch(_0x4cf2b4){try{const _0x5f4974=JSON[_0x3396a1(0x1f5)](_0x4cf2b4[_0x3396a1(0x242)]);let _0x327492=parseInt(_0x5f4974?.[_0x3396a1(0x29a)]?.[_0x3396a1(0x262)]);if(isNaN(_0x327492))_0x327492=undefined;_0x312c3f[_0x3396a1(0x2ef)][_0x3396a1(0x262)]=_0x327492||_0x5f4974?.[_0x3396a1(0x20d)]||0x1f4,_0x312c3f[_0x3396a1(0x2ef)]['body']=_0x5f4974[_0x3396a1(0x29a)]?JSON['stringify'](_0x5f4974[_0x3396a1(0x29a)]):_0x4cf2b4[_0x3396a1(0x242)];}catch(_0x54dd65){_0x312c3f[_0x3396a1(0x2ef)][_0x3396a1(0x262)]=0x1f4,_0x4806c9['logger'][_0x3396a1(0x2ca)](_0x4806c9[_0x3396a1(0x24d)]+'['+_0x4806c9[_0x3396a1(0x271)]+']\x20onChainingHandler\x20error:\x20'+_0x4cf2b4[_0x3396a1(0x242)]);}}};}}export class Publisher{constructor(_0x1a2bc5){const _0xfef890=a0_0x34d9,_0x26531e=_0x1a2bc5,_0xf1469a={},_0x252325=async(_0x41a5c8,_0x43dccc)=>{const _0x4b13e7=a0_0x34d9,_0x347ac7=_0xf1469a[_0x41a5c8][_0x4b13e7(0x2c7)]?.[_0x4b13e7(0x1e8)]?.['subject'];let _0x231ef6=0x0;for await(const _0x63f8fc of _0x43dccc[_0x4b13e7(0x262)]()){switch(_0x63f8fc[_0x4b13e7(0x2f0)]){case _0x4b13e7(0x2ba):_0x26531e[_0x4b13e7(0x2f3)]['error'](_0x26531e[_0x4b13e7(0x24d)]+'['+_0x26531e['pluginName']+_0x4b13e7(0x268)+_0x41a5c8+']['+_0x347ac7+_0x4b13e7(0x2be)+_0x63f8fc[_0x4b13e7(0x2ad)]+'\x20-\x20will\x20do\x20auto\x20reconnect\x20when\x20connection\x20becomes\x20available'),_0x231ef6=0x0;break;case _0x4b13e7(0x204):_0x26531e[_0x4b13e7(0x2f3)][_0x4b13e7(0x2f7)](_0x26531e[_0x4b13e7(0x24d)]+'['+_0x26531e[_0x4b13e7(0x271)]+']\x20publisher['+_0x41a5c8+']['+_0x347ac7+_0x4b13e7(0x215)+_0x63f8fc[_0x4b13e7(0x2ad)]);break;case _0x4b13e7(0x2ca):_0x26531e['logger'][_0x4b13e7(0x2ca)](_0x26531e['gwName']+'['+_0x26531e['pluginName']+_0x4b13e7(0x268)+_0x41a5c8+']['+_0x347ac7+_0x4b13e7(0x265)+_0x63f8fc[_0x4b13e7(0x2ad)]);break;case'reconnecting':_0x231ef6+=0x1;_0x231ef6%0x1e===0x0&&_0x26531e[_0x4b13e7(0x2f3)][_0x4b13e7(0x243)](_0x26531e['gwName']+'['+_0x26531e[_0x4b13e7(0x271)]+_0x4b13e7(0x268)+_0x41a5c8+']['+_0x347ac7+']\x20client\x20is\x20attempting\x20to\x20reconnect\x20'+_0x63f8fc[_0x4b13e7(0x2ad)]+_0x4b13e7(0x1ea)+_0x231ef6+')');break;case'staleConnection':_0x26531e[_0x4b13e7(0x2f3)]['debug'](_0x26531e[_0x4b13e7(0x24d)]+'['+_0x26531e[_0x4b13e7(0x271)]+']\x20publisher['+_0x41a5c8+']['+_0x347ac7+_0x4b13e7(0x27f)+_0x63f8fc['data']);break;}}},_0x28c132=async(_0x5ee044,_0x54d0d7)=>{const _0x3d8936=a0_0x34d9,_0x1ace9=_0xf1469a[_0x5ee044][_0x3d8936(0x2c7)]?.[_0x3d8936(0x1e8)]?.[_0x3d8936(0x27a)];let _0xd576b4;try{_0xd576b4=await a0_0x2986f3(_0x54d0d7);if(_0xd576b4[_0x3d8936(0x2f7)][_0x3d8936(0x2bb)]!=='SCIM-Stream'){_0xd576b4[_0x3d8936(0x2a5)]();return;}_0xf1469a[_0x5ee044]['nc']=_0xd576b4,_0x252325(_0x5ee044,_0xd576b4);}catch(_0x1980b2){_0x26531e['logger']['error'](_0x26531e[_0x3d8936(0x24d)]+'['+_0x26531e['pluginName']+_0x3d8936(0x268)+_0x5ee044+']['+_0x1ace9+_0x3d8936(0x26b)+_0x1980b2[_0x3d8936(0x242)]+'\x20-\x20will\x20do\x20auto\x20connect\x20when\x20available\x20-\x20however,\x20please\x20verify\x20stream\x20configuration'),_0x54d0d7[_0x3d8936(0x1f0)]=!![];try{_0xd576b4=await a0_0x2986f3(_0x54d0d7);if(_0xd576b4[_0x3d8936(0x2f7)][_0x3d8936(0x2bb)]!==_0x3d8936(0x302)){_0xd576b4['close']();return;}_0xf1469a[_0x5ee044]['nc']=_0xd576b4,_0x252325(_0x5ee044,_0xd576b4);}catch(_0x2f0914){_0x26531e[_0x3d8936(0x2f3)]['error'](_0x26531e[_0x3d8936(0x24d)]+'['+_0x26531e[_0x3d8936(0x271)]+_0x3d8936(0x268)+_0x5ee044+']['+_0x1ace9+_0x3d8936(0x26b)+_0x2f0914[_0x3d8936(0x242)]);return;}}_0x26531e[_0x3d8936(0x2f3)][_0x3d8936(0x243)](_0x26531e['gwName']+'['+_0x26531e['pluginName']+_0x3d8936(0x268)+_0x5ee044+']['+_0x1ace9+_0x3d8936(0x2f6)+(_0x54d0d7['tls']['ca']?_0x3d8936(0x2f2):'')+'\x20'+_0xd576b4[_0x3d8936(0x21d)]()),_0xd576b4['closed']()[_0x3d8936(0x276)](_0xd0e2d5=>{const _0x450bf3=_0x3d8936;_0xd0e2d5&&_0x26531e['logger'][_0x450bf3(0x2ca)](_0x26531e[_0x450bf3(0x24d)]+'['+_0x26531e[_0x450bf3(0x271)]+_0x450bf3(0x268)+_0x5ee044+']['+_0x1ace9+']\x20closed\x20with\x20error:\x20'+_0xd0e2d5[_0x450bf3(0x242)]);});};this[_0xfef890(0x304)]=async(_0x1c9ad2,_0x21d624)=>{const _0x5c6dd4=_0xfef890;if(!_0x21d624?.[_0x5c6dd4(0x1e8)]){_0x26531e[_0x5c6dd4(0x2f3)][_0x5c6dd4(0x2ca)](_0x26531e[_0x5c6dd4(0x24d)]+'['+_0x26531e[_0x5c6dd4(0x271)]+']\x20publisher['+_0x1c9ad2+_0x5c6dd4(0x2b8));return;}if(!_0x21d624?.[_0x5c6dd4(0x1e8)]?.[_0x5c6dd4(0x20c)]){_0x26531e[_0x5c6dd4(0x2f3)][_0x5c6dd4(0x2ca)](_0x26531e[_0x5c6dd4(0x24d)]+'['+_0x26531e['pluginName']+_0x5c6dd4(0x268)+_0x1c9ad2+']\x20initialization\x20error:\x20missing\x20configuration\x20nats.tenant');return;}if(!_0x21d624?.[_0x5c6dd4(0x1e8)]?.['subject']){_0x26531e[_0x5c6dd4(0x2f3)][_0x5c6dd4(0x2ca)](_0x26531e[_0x5c6dd4(0x24d)]+'['+_0x26531e[_0x5c6dd4(0x271)]+']\x20publisher['+_0x1c9ad2+_0x5c6dd4(0x2fb));return;}if(!_0x21d624?.[_0x5c6dd4(0x1e8)]?.[_0x5c6dd4(0x27a)][_0x5c6dd4(0x2e6)](_0x5c6dd4(0x2ab))){_0x26531e[_0x5c6dd4(0x2f3)][_0x5c6dd4(0x2ca)](_0x26531e[_0x5c6dd4(0x24d)]+'['+_0x26531e[_0x5c6dd4(0x271)]+_0x5c6dd4(0x268)+_0x1c9ad2+_0x5c6dd4(0x2a4));return;}if(!_0x21d624[_0x5c6dd4(0x21a)]||!Array[_0x5c6dd4(0x2e3)](_0x21d624[_0x5c6dd4(0x21a)])||_0x21d624[_0x5c6dd4(0x21a)]['length']<0x1){_0x26531e[_0x5c6dd4(0x2f3)][_0x5c6dd4(0x2ca)](_0x26531e[_0x5c6dd4(0x24d)]+'['+_0x26531e[_0x5c6dd4(0x271)]+_0x5c6dd4(0x268)+_0x1c9ad2+']\x20initialization\x20error:\x20missing\x20configuration\x20stream.baseUrls');return;}if(!_0x21d624?.[_0x5c6dd4(0x23b)]?.['ca']){_0x26531e['logger']['error'](_0x26531e['gwName']+'['+_0x26531e[_0x5c6dd4(0x271)]+']\x20publisher['+_0x1c9ad2+_0x5c6dd4(0x2cd));return;}const _0x52dd7c={};try{let _0x39161c=a0_0x3bb54d[_0x5c6dd4(0x2a7)](_0x26531e[_0x5c6dd4(0x2d1)],_0x5c6dd4(0x239),_0x21d624?.[_0x5c6dd4(0x23b)]?.['ca']||_0x5c6dd4(0x1ee));(_0x21d624?.['certificate']?.['ca']?.['startsWith']('/')||_0x21d624?.[_0x5c6dd4(0x23b)]?.['ca']?.[_0x5c6dd4(0x205)]('\x5c'))&&(_0x39161c=_0x21d624[_0x5c6dd4(0x23b)]['ca']),_0x52dd7c['ca']=[a0_0x3f708b['readFileSync'](_0x39161c)],_0x52dd7c[_0x5c6dd4(0x20f)]=!![];}catch(_0xe4634b){_0x26531e['logger'][_0x5c6dd4(0x2ca)](_0x26531e[_0x5c6dd4(0x24d)]+'['+_0x26531e['pluginName']+_0x5c6dd4(0x268)+_0x1c9ad2+_0x5c6dd4(0x23a)+_0xe4634b[_0x5c6dd4(0x242)]);return;}const _0x34e9b9={},_0x1cd8c7=new TextEncoder()[_0x5c6dd4(0x214)](_0x21d624?.['nats']?.['secret']),_0x13c444=_0x21d624?.[_0x5c6dd4(0x1e8)]?.[_0x5c6dd4(0x1e9)];_0x34e9b9[_0x5c6dd4(0x2a9)]=jwtAuthenticator(_0x13c444,_0x1cd8c7),_0x34e9b9[_0x5c6dd4(0x2e0)]=_0x21d624[_0x5c6dd4(0x21a)],_0x34e9b9[_0x5c6dd4(0x2f2)]=_0x52dd7c,_0x34e9b9['waitOnFirstConnect']=![],_0x34e9b9['reconnect']=!![],_0x34e9b9[_0x5c6dd4(0x2b4)]=0x3e8*0xa,_0x34e9b9[_0x5c6dd4(0x207)]=-0x1,_0x34e9b9[_0x5c6dd4(0x2d4)]=0x2*0x3c*0x3e8,_0x34e9b9[_0x5c6dd4(0x201)]=0x5,_0x34e9b9['debug']=![],_0xf1469a[_0x1c9ad2]={},_0xf1469a[_0x1c9ad2][_0x5c6dd4(0x2c7)]=_0x21d624,_0xf1469a[_0x1c9ad2]['nc']=undefined,_0x28c132(_0x1c9ad2,_0x34e9b9);},this[_0xfef890(0x213)]=async _0x5edfa8=>{const _0x574d47=_0xfef890;let _0x1d209d;const _0x361af8=a0_0x15e0d8[_0x574d47(0x2da)]();try{if(_0x5edfa8[_0x574d47(0x2b6)]===Object){_0x1d209d=_0x5edfa8[_0x574d47(0x25a)];if(!_0x1d209d)_0x5edfa8[_0x574d47(0x25a)]=_0x574d47(0x295);if(_0x5edfa8?.[_0x574d47(0x2f5)]?.['request']?.['headers']){const _0x259d4b=_0x5edfa8[_0x574d47(0x2f5)]['request'][_0x574d47(0x237)][_0x574d47(0x24c)](_0x574d47(0x297));if(_0x259d4b)_0x5edfa8[_0x574d47(0x2f5)][_0x574d47(0x27e)][_0x574d47(0x237)][_0x574d47(0x261)](_0x574d47(0x297),a0_0x35610e[_0x574d47(0x1f3)](_0x259d4b,_0x361af8));}if(_0x5edfa8?.['ctx']?.[_0x574d47(0x2ea)]?.[_0x574d47(0x237)]){const _0x1f71d1=_0x5edfa8[_0x574d47(0x2f5)][_0x574d47(0x2ea)][_0x574d47(0x237)]['get'](_0x574d47(0x297));if(_0x1f71d1)_0x5edfa8['ctx'][_0x574d47(0x2ea)][_0x574d47(0x237)]['set'](_0x574d47(0x297),a0_0x35610e[_0x574d47(0x1f3)](_0x1f71d1,_0x361af8));}_0x5edfa8=JSON[_0x574d47(0x235)](_0x5edfa8);}else{const _0x3fde0d=JSON['parse'](_0x5edfa8);_0x1d209d=_0x3fde0d['baseEntity'];}}catch(_0x27eb6a){throw new Error(_0x574d47(0x22c)+_0x1d209d+_0x574d47(0x22f));}if(!_0xf1469a[_0x1d209d])throw new Error(_0x574d47(0x22c)+_0x1d209d+_0x574d47(0x309)+_0x1d209d);const _0x1c3fc1=headers();_0x1c3fc1[_0x574d47(0x2bc)]('Msg-Id',_0x361af8);let _0x5c78e2;try{if(!_0xf1469a[_0x1d209d]['nc'])throw new Error(_0x574d47(0x2c2));_0x5c78e2=await _0xf1469a[_0x1d209d]['nc'][_0x574d47(0x27e)](_0xf1469a[_0x1d209d][_0x574d47(0x2c7)]?.[_0x574d47(0x1e8)]?.[_0x574d47(0x27a)],_0x5edfa8,{'headers':_0x1c3fc1});}catch(_0x390578){if(_0x390578[_0x574d47(0x242)]===_0x574d47(0x240))throw new Error('publisher['+_0x1d209d+']\x20error:\x20no\x20subscribers/responders\x20to\x20subject\x20'+_0xf1469a[_0x1d209d][_0x574d47(0x2c7)]?.[_0x574d47(0x1e8)]?.[_0x574d47(0x27a)]);else throw new Error(_0x574d47(0x22c)+_0x1d209d+_0x574d47(0x255)+_0x390578[_0x574d47(0x242)]);}let _0x1ea3d8;try{_0x1ea3d8=JSON[_0x574d47(0x1f5)](_0x5c78e2['string']());try{JSON[_0x574d47(0x1f5)](_0x1ea3d8['body']);if(!_0x1ea3d8[_0x574d47(0x237)])_0x1ea3d8[_0x574d47(0x237)]={};if(!_0x1ea3d8[_0x574d47(0x237)][_0x574d47(0x2ff)])_0x1ea3d8[_0x574d47(0x237)][_0x574d47(0x2ff)]=_0x574d47(0x2b7);}catch(_0x408562){void 0x0;}}catch(_0x2b78f3){throw new Error(_0x574d47(0x2fe)+_0x5c78e2['string']());}if(_0x1ea3d8?.[_0x574d47(0x2ca)]){const _0x2454d0=new Error(_0x574d47(0x2de)+_0x1ea3d8['error']);_0x2454d0['name']=_0x1ea3d8[_0x574d47(0x301)];throw _0x2454d0;}return _0x1ea3d8;},process['on'](_0xfef890(0x23e),async()=>{const _0x21490e=_0xfef890;for(const _0x56620c in _0xf1469a){_0xf1469a[_0x56620c]['nc']&&!_0xf1469a[_0x56620c]['nc'][_0x21490e(0x2b9)]()&&await _0xf1469a[_0x56620c]['nc'][_0x21490e(0x226)]();}}),process['on'](_0xfef890(0x2cb),async()=>{const _0x458bfe=_0xfef890;for(const _0x591063 in _0xf1469a){_0xf1469a[_0x591063]['nc']&&!_0xf1469a[_0x591063]['nc'][_0x458bfe(0x2b9)]()&&await _0xf1469a[_0x591063]['nc'][_0x458bfe(0x226)]();}});}}export const getAppRoles=async(_0x18807a,_0x4ffed2)=>{const _0x47e713=a0_0x34d9,_0x5f2709=_0x47e713(0x2ec),_0x3b1985=_0x18807a;_0x3b1985[_0x47e713(0x2f3)]['debug'](_0x3b1985['gwName']+'['+_0x3b1985[_0x47e713(0x271)]+_0x47e713(0x2db)+_0x5f2709+'\x22');try{if(!a0_0x3f708b[_0x47e713(0x28e)](_0x3b1985[_0x47e713(0x2d1)]+_0x47e713(0x236)))a0_0x3f708b[_0x47e713(0x210)](_0x3b1985['configDir']+_0x47e713(0x236));}catch(_0x550efb){void 0x0;}const _0x4e7acc=a0_0x3bb54d[_0x47e713(0x2a7)](''+_0x3b1985[_0x47e713(0x2d1)],'approles',_0x47e713(0x2e5)+_0x3b1985[_0x47e713(0x271)]+_0x47e713(0x28b)),_0x3c2413={};a0_0x35610e[_0x47e713(0x254)](_0x4e7acc)&&a0_0x3f708b[_0x47e713(0x1ff)](_0x4e7acc,_0x47e713(0x227))['split'](/\r?\n/)[_0x47e713(0x2d5)](_0x3b89ae=>{const _0x221c88=_0x47e713,_0x2a254b=_0x3b89ae[_0x221c88(0x24b)]('\x20');_0x2a254b[_0x221c88(0x23d)]===0x2&&(_0x3c2413[_0x2a254b[0x0]]=_0x2a254b[0x1]);});const _0x128246=a0_0x3f708b[_0x47e713(0x2d7)](_0x4e7acc,{'flags':'w','encoding':_0x47e713(0x2d6),'mode':0x1b6,'autoClose':!![]}),_0x72e5d1=[],_0x3d325d=await _0x3b1985[_0x47e713(0x2d0)](_0x4ffed2,{'attribute':undefined,'operator':undefined,'value':undefined},['id','displayName']);return _0x3d325d[_0x47e713(0x253)][_0x47e713(0x2d5)](_0x31bab5=>{const _0x10a086=_0x47e713;if(_0x31bab5['id']){let _0xc6a3db=a0_0x15e0d8[_0x10a086(0x2da)]();if(_0x3c2413[_0x31bab5['id']])_0xc6a3db=_0x3c2413[_0x31bab5['id']];const _0x143bc5={'allowedMemberTypes':[_0x10a086(0x273)],'description':'SCIM\x20Stream\x20-\x20Autogenerated','displayName':_0x31bab5['displayName']||_0x31bab5['id'],'id':_0xc6a3db,'isEnabled':!![],'lang':null,'origin':_0x10a086(0x290),'value':decodeURIComponent(_0x31bab5['id'])};_0x72e5d1[_0x10a086(0x24e)](_0x143bc5),_0x128246[_0x10a086(0x2cc)](_0x31bab5['id']+'\x20'+_0xc6a3db+'\x0a');}}),_0x128246[_0x47e713(0x2a5)](),_0x3b1985[_0x47e713(0x2f3)]['debug'](_0x3b1985[_0x47e713(0x24d)]+'['+_0x3b1985[_0x47e713(0x271)]+']\x20approle\x20uuid\x20file\x20created:\x20'+_0x4e7acc),{'Resources':[{'appRoles':_0x72e5d1}]};};